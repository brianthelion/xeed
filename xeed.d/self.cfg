[xeed.tools.self]
depends_on: xeed.tools.docker

[xeed.tools.self.vars]
tag: {xeed.vars.project}-self:{xeed.vars.HASH}
dockerfile: {xeed.tools.self.files.test.path}
cachedir: {xeed.vars.cachedir}/{xeed.vars.HASH}
log_path: {xeed.vars.cachedir}/{xeed.vars.HASH}/log

[xeed.tools.self.cmds.self/build]
type: xeed.types.tool.subtypes.clitool
cmdstr: docker build \
  -f {xeed.tools.self.vars.dockerfile} \
  -t {xeed.tools.self.vars.tag} \
  ./

[xeed.tools.self.cmds.self/test]
type: xeed.types.tool.subtypes.clitool
cmdstr: {xeed.vars.PREFIX} self/build >> {xeed.tools.self.vars.log_path} 2>&1 && \
  {xeed.vars.PREFIX} docker run -it \
  -v {xeed.vars.env.PWD}:{xeed.vars.env.PWD} \
  -w {xeed.vars.env.PWD} \
  -e PYTHONDONTWRITEBYTECODE=1 \
  {xeed.tools.self.vars.tag} \
  pytest -vvv {xeed.vars.PREFIX}

[xeed.tools.self.cmds.self/help]
type: xeed.types.tool.subtypes.pytool
code:
    : cli.print_help('{xeed.vars.HASH}')

[xeed.tools.self.files.test]
path: {xeed.tools.self.vars.cachedir}/xeed-self.df
contents:
  FROM python:latest
  RUN pip install --upgrade pip wheel
  RUN pip install pytest
